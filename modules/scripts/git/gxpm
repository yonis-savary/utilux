#!/bin/sh

protected_branches="master|main|develop"
merged_branches=$(git branch --merged | grep -vE "\*|$protected_branches" | sed 's/^ *//')

if [ -z "$merged_branches" ]
then
  echo "✅ No merged branches to delete."
  exit 0
fi

echo "⚠️ The following branches are merged and will be force-deleted:"
echo "$merged_branches"
echo

if [ "$1" != "--force" -a "$1" != "-y" ]
then
  printf "Proceed with deletion ? [y/N]"
  read -r answer
  echo
  if ! echo "$answer" | grep -q -E '^[Yy]$'; then
    echo "❌ Aborted."
    exit 0
  fi
fi

echo "$merged_branches" | xargs -n 1 git branch -D